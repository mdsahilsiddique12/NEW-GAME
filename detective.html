<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detective Killer | Surveillance Mode</title>
  <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Rajdhani:wght@500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/detective.js" defer></script>

  <style>
    :root {
      --neon-red: #ff2a2a;
      --neon-cyan: #00f3ff;
      --radar-green: #00ff41;
      --bg-dark: #050505;
      --panel-bg: rgba(10, 15, 20, 0.95);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background-color: var(--bg-dark);
      color: #fff;
      font-family: 'Rajdhani', sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
    }

    /* --- LAYOUT (UNCHANGED) --- */
    .main-wrapper { display: flex; width: 100%; height: 100%; position: relative; z-index: 10; }
    
    .side-panel {
      width: 300px; background: rgba(0,0,0,0.85); border-right: 1px solid var(--radar-green);
      display: flex; flex-direction: column; padding: 20px; backdrop-filter: blur(10px); z-index: 20;
    }
    .side-header { font-family: 'Black Ops One'; color: var(--radar-green); font-size: 1.5rem; text-align: center; border-bottom: 1px dashed var(--radar-green); padding-bottom: 10px; margin-bottom: 20px; }
    .score-list { flex-grow: 1; overflow-y: auto; }
    .score-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; font-family: 'Share Tech Mono'; font-size: 0.9rem; }
    .side-footer { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }

    .game-area { flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: center; padding: 20px; }
    .terminal-container {
      width: 100%; max-width: 600px; background: var(--panel-bg); border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 50px rgba(0,0,0,0.8); padding: 30px; border-radius: 5px; position: relative; overflow: hidden;
    }

    /* --- NEW OVERLAYS --- */
    .grid-bg {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-image: linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
      background-size: 20px 20px; pointer-events: none; z-index: 0;
    }
    .scan-line {
      position: absolute; top: 0; left: 0; width: 100%; height: 2px;
      background: rgba(0, 255, 65, 0.2);
      animation: scan 3s linear infinite; pointer-events: none; z-index: 1;
    }
    @keyframes scan { 0% {top:0;} 100% {top:100%;} }

    /* --- UI COMPONENTS --- */
    h1 { font-family: 'Black Ops One'; color: #fff; text-align: center; font-size: 2.5rem; text-transform: uppercase; z-index: 2; position: relative; }
    .btn { width: 100%; padding: 12px; border: none; cursor: pointer; font-family: 'Share Tech Mono'; font-weight: bold; text-transform: uppercase; transition: 0.2s; margin-bottom: 10px; position: relative; z-index: 2; }
    .btn-primary { background: var(--radar-green); color: #000; }
    .btn-primary:hover { box-shadow: 0 0 15px var(--radar-green); }
    .btn-danger { background: rgba(255,0,0,0.1); border:1px solid red; color: red; }
    .btn-danger:hover { background: red; color: white; box-shadow: 0 0 20px red; }
    .input-field { width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: #fff; font-family: 'Share Tech Mono'; margin-bottom: 15px; text-align: center; z-index: 2; position: relative; }
    .input-field:focus { border-color: var(--radar-green); outline: none; }

    /* --- GAMEPLAY --- */
    .player-list { position: relative; z-index: 2; }
    
    /* HOVER RETICLE EFFECT */
    .player-row { 
      display: flex; justify-content: space-between; align-items: center; padding: 12px; 
      border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); 
      margin-bottom: 8px; position: relative; transition: 0.3s;
    }
    .player-row:hover { background: rgba(0, 255, 65, 0.05); border-color: var(--radar-green); }
    .player-row.dead { text-decoration: line-through; color: #555; background: #1a0000; border-color: #330000; }
    
    .copy-btn {
      background: transparent; border: 1px solid var(--radar-green); color: var(--radar-green);
      padding: 4px 10px; cursor: pointer; font-family: 'Share Tech Mono'; font-size: 0.8rem;
      margin-left: 10px; transition: 0.3s; vertical-align: middle;
    }
    .copy-btn:hover { background: var(--radar-green); color: #000; }

    /* --- IN-GAME MODAL (Replaces Browser Alert) --- */
    .custom-modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
      z-index: 1000; display: none; justify-content: center; align-items: center;
      backdrop-filter: blur(5px);
    }
    .custom-modal {
      background: #050505; border: 2px solid #fff; width: 90%; max-width: 450px; padding: 25px; text-align: center;
      box-shadow: 0 0 40px rgba(0,0,0,0.8); position: relative;
    }
    .custom-modal::before { /* Corner accents */
      content:''; position: absolute; top:-2px; left:-2px; width:15px; height:15px; border-top:2px solid var(--radar-green); border-left:2px solid var(--radar-green);
    }
    .custom-modal::after {
      content:''; position: absolute; bottom:-2px; right:-2px; width:15px; height:15px; border-bottom:2px solid var(--radar-green); border-right:2px solid var(--radar-green);
    }
    
    .modal-title { font-family: 'Black Ops One'; font-size: 1.8rem; margin-bottom: 10px; color: #fff; }
    .modal-body { font-family: 'Share Tech Mono'; color: #aaa; margin-bottom: 25px; line-height: 1.4; }
    .modal-actions { display: flex; gap: 15px; justify-content: center; }

    /* --- TRANSITION SCREEN --- */
    .transition-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000;
      z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center;
    }
    .glitch-text {
      font-family: 'Black Ops One'; font-size: 3rem; color: var(--radar-green);
      animation: glitch 0.3s infinite;
    }
    @keyframes glitch {
      0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) }
    }

    @media (max-width: 768px) { .main-wrapper { flex-direction: column; } .side-panel { width: 100%; height: 150px; } }
  </style>
</head>
<body>

  <!-- Overlays -->
  <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:url('https://grainy-gradients.vercel.app/noise.svg'); opacity:0.04; pointer-events:none; z-index:5;"></div>

  <!-- Custom Action Modal -->
  <div id="customModal" class="custom-modal-overlay">
    <div class="custom-modal" id="modalBox">
      <div class="modal-title" id="modalTitle">CONFIRM</div>
      <div class="modal-body" id="modalBody">...</div>
      <div class="modal-actions">
        <button class="btn" style="background:transparent; border:1px solid #444; color:#888;" onclick="closeModal()">CANCEL</button>
        <button class="btn btn-primary" id="modalConfirmBtn">CONFIRM</button>
      </div>
    </div>
  </div>

  <!-- Round Transition -->
  <div id="transitionScreen" class="transition-layer">
    <div class="glitch-text">SYSTEM REBOOT</div>
    <div style="font-family:'Share Tech Mono'; margin-top:10px; color:#666;">LOADING NEXT SEQUENCE...</div>
  </div>

  <!-- History Modal -->
  <div id="historyModal" class="custom-modal-overlay" style="z-index: 900;">
    <div class="custom-modal">
      <div class="modal-title" style="color:var(--radar-green)">MISSION LOGS</div>
      <div id="historyContent" style="text-align:left; max-height:300px; overflow-y:auto; margin-bottom:20px; font-family:'Share Tech Mono'; font-size:0.8rem; border-top:1px solid #333;"></div>
      <button class="btn btn-primary" onclick="document.getElementById('historyModal').style.display='none'">CLOSE</button>
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <div class="main-wrapper">
    <!-- LEFT PANEL -->
    <aside class="side-panel" id="scorePanel" style="display:none;">
      <div class="side-header">AGENT STATUS</div>
      <div class="score-list" id="scoreList"></div>
      <div class="side-footer">
        <button id="viewHistoryBtn" class="btn" style="border:1px solid var(--neon-cyan); color:var(--neon-cyan); background:transparent;">VIEW LOGS</button>
        <button id="leaveBtn" class="btn btn-danger">DISCONNECT</button>
      </div>
    </aside>

    <!-- CENTER TERMINAL -->
    <main class="game-area">
      <div class="terminal-container">
        <!-- Inner Terminal Effects -->
        <div class="grid-bg"></div>
        <div class="scan-line"></div>

        <header>
          <h1>DETECTIVE KILLER</h1>
          <div style="text-align:center; color:var(--radar-green); font-family:'Share Tech Mono'; font-size:0.8rem; letter-spacing:4px; margin-bottom:30px; position:relative; z-index:2;">
            :: SECURE UPLINK ESTABLISHED ::
          </div>
        </header>

        <!-- VIEW 1: MAIN MENU -->
        <div id="mainMenu" style="position:relative; z-index:2;">
          <input type="text" id="playerNameInput" class="input-field" placeholder="ENTER AGENT NAME">
          <button id="createBtn" class="btn btn-primary">NEW OPERATION</button>
          <button id="joinBtn" class="btn" style="border:1px solid var(--neon-cyan); color:var(--neon-cyan); background:transparent;">JOIN MISSION</button>
          
          <div id="joinInputs" style="display:none; margin-top:15px; border-top:1px dashed #333; padding-top:15px;">
            <input type="text" id="roomCodeInput" class="input-field" placeholder="ENTER ROOM CODE" style="text-transform:uppercase;">
            <button id="confirmJoinBtn" class="btn btn-primary">CONNECT</button>
          </div>
        </div>

        <!-- VIEW 2: GAME -->
        <div id="gameContent" style="display:none; position:relative; z-index:2;"></div>
      </div>
    </main>
  </div>

</body>
</html>
