<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raja Mantri Chor Sipahi</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Optional External CSS if you have it -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Internal CSS for Top-Notch GUI -->
  <style>
    :root { font-family: 'Inter', sans-serif; }

    /* Main Background */
    .centered-bg {
      background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 1rem;
    }

    .logo-block {
      margin-bottom: 2rem;
      text-align: center;
    }

    /* Screen Containers */
    .menu-screen {
      display: none; /* Hidden by default, toggled by JS */
      width: 100%;
      max-width: 380px;
      padding: 2rem;
      background-color: #ffffff;
      border-radius: 1.5rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: fadeIn 0.5s ease-out;
    }
    
    .active-screen {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Buttons & Inputs */
    .giant-btn {
      @apply w-full py-4 rounded-xl text-xl font-bold text-white shadow-lg transform transition hover:scale-105 active:scale-95;
    }
    .create-btn { background: linear-gradient(to right, #4f46e5, #6366f1); }
    .join-btn { background: linear-gradient(to right, #10b981, #34d399); }
    
    .confirm-btn {
      @apply w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition shadow-md;
    }
    .back-btn {
      @apply w-full bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition mt-2;
    }
    .input-field {
      @apply w-full p-4 border-2 border-gray-200 rounded-xl text-lg focus:outline-none focus:border-indigo-500 transition bg-gray-50;
    }
    .error-msg { @apply text-red-500 text-sm text-center mt-2 font-semibold; }

    /* Room Code Display */
    .room-code-display {
      background-color: #eff6ff;
      border: 2px dashed #bfdbfe;
      color: #1e40af;
      padding: 0.75rem;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }
    .room-code-display-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    /* 3D Game Table */
    .game-table {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      perspective: 1000px;
    }
    .table {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 30%, #ffd700, #d4af37);
      border-radius: 50%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(255, 255, 255, 0.4);
      z-index: 1;
    }
    
    /* Avatars */
    .avatar {
      position: absolute;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      transition: all 0.3s ease;
    }
    .avatar-name {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      white-space: nowrap;
    }

    /* Dynamic Game Content (Overlays the table) */
    #gameContent {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none; /* Toggled by JS */
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10; /* Must be higher than table/avatars */
      background: rgba(255, 255, 255, 0.85); /* Semi-transparent overlay */
      backdrop-filter: blur(4px);
      border-radius: 20px;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    .paper-unfold { animation: unfold 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
    @keyframes unfold {
      0% { transform: scaleY(0.005) scaleX(0); }
      50% { transform: scaleY(0.005) scaleX(1); }
      100% { transform: scaleY(1) scaleX(1); }
    }

    /* Message Box */
    #messageBox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    #messageBoxContent {
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 90%;
      width: 320px;
      text-align: center;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .hidden { display: none !important; }
  </style>

  <!-- EXACT SCRIPTS REQUESTED -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script> 
  <script src="js/firebase-config.js"></script>
  <script src="js/rmcs.js"></script>
</head>
<body>

  <div class="centered-bg">
    <!-- Logo Area -->
    <div class="logo-block">
      <svg class="w-24 h-24 sm:w-32 sm:h-32 text-indigo-700 mx-auto drop-shadow-xl" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="5" width="90" height="90" rx="20" fill="white" stroke="#e2e8f0" stroke-width="2"/>
        <text x="50" y="65" font-size="40" text-anchor="middle" fill="#4f46e5">ðŸ‘‘</text>
      </svg>
      <h1 class="text-4xl font-extrabold text-gray-800 mt-4 tracking-tight">Raja Mantri<br>Chor Sipahi</h1>
    </div>

    <!-- SCREENS WRAPPER -->
    <div id="screens" class="w-full flex justify-center">
      
      <!-- 1. Main Menu -->
      <div id="mainMenu" class="menu-screen active-screen">
        <button class="create-btn giant-btn">Create Room</button>
        <button class="join-btn giant-btn">Join Room</button>
      </div>

      <!-- 2. Create Room -->
      <div id="createScreen" class="menu-screen">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Create New Room</h2>
        <input type="text" id="createPlayerName" class="input-field" placeholder="Your Name">
        <input type="text" id="createRoomCode" class="input-field mt-3 uppercase" maxlength="8" placeholder="Room Code (Optional)">
        <div id="createRoomError" class="error-msg"></div>
        <div class="mt-6 space-y-2">
          <button id="createRoomFinal" class="confirm-btn">Create Room</button>
          <button class="back-btn">Back</button>
        </div>
      </div>

      <!-- 3. Join Room -->
      <div id="joinScreen" class="menu-screen">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Join Room</h2>
        <input type="text" id="joinPlayerName" class="input-field" placeholder="Your Name">
        <input type="text" id="joinRoomCode" class="input-field mt-3 uppercase" maxlength="8" placeholder="Room Code">
        <div id="joinRoomError" class="error-msg"></div>
        <div class="mt-6 space-y-2">
          <button id="joinRoomFinal" class="confirm-btn">Join Room</button>
          <button class="back-btn">Back</button>
        </div>
      </div>

      <!-- 4. Game Screen (Lobby) -->
      <div id="gameScreen" class="menu-screen" style="max-width: 600px;"> <!-- Wider for game -->
        <div class="flex justify-between items-center mb-2">
           <h2 class="text-2xl font-bold text-gray-800">Game Room</h2>
           <button id="exitLobbyBtn" class="text-red-500 text-sm font-bold hover:underline">Exit</button>
        </div>

        <!-- Room Code -->
        <div id="currentRoomCode" class="room-code-display"></div>

        <!-- Main Game Layout -->
        <div class="flex flex-col md:flex-row gap-4 items-start">
          
          <!-- Scoreboard (Always Visible) -->
          <div id="scoreboard" class="w-full md:w-1/3 bg-white p-3 rounded-xl border border-gray-100 shadow-sm order-2 md:order-1">
            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 border-b pb-1">Scoreboard</h3>
            <div id="scoreList" class="space-y-2 max-h-32 overflow-y-auto">
              <!-- Scores injected here -->
              <div class="text-center text-gray-400 text-xs">Waiting for players...</div>
            </div>
          </div>

          <!-- Game Table Area -->
          <div class="flex-1 w-full relative order-1 md:order-2 flex flex-col items-center">
            
            <!-- The Visual Table -->
            <div class="game-table">
              <div class="table"></div> <!-- Background Circle -->
              <!-- Dynamic Content Overlay (Reveals, Guesses) -->
              <div id="gameContent"></div> 
            </div>

            <!-- Start Button Area -->
            <div class="mt-6 w-full max-w-xs z-20">
               <button id="startGameBtn" class="confirm-btn bg-green-600 hover:bg-green-700 shadow-lg">
                 Start Game
               </button>
               <button id="cancelRoomBtn" class="w-full mt-3 text-red-500 text-sm font-bold hover:bg-red-50 p-2 rounded">
                 Cancel Room
               </button>
            </div>

          </div>
        </div>

        <!-- Player List (Lobby View) -->
        <div class="mt-4 border-t pt-2">
          <h3 class="text-sm font-bold text-gray-500 mb-2">Players in Lobby:</h3>
          <div id="playersList" class="flex flex-wrap gap-2"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- Message Box Modal -->
  <div id="messageBox" class="hidden">
    <div id="messageBoxContent">
      <h3 id="messageBoxTitle" class="text-xl font-bold mb-2 text-gray-800">Message</h3>
      <p id="messageBoxBody" class="text-gray-600 mb-6">Body text...</p>
      <button id="messageBoxClose" class="confirm-btn">OK</button>
    </div>
  </div>

</body>
</html>
